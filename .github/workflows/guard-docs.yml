name: Guard Docs
on:
  pull_request:
    branches: [main]
jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Scan only PR changes
        shell: bash
        run: |
          set -euo pipefail
          base="${{ github.event.pull_request.base.sha }}"
          head="${{ github.sha }}"
          files="$(git diff --name-only "$base..$head" || true)"
          if [ -z "${files}" ]; then
            echo "No changed files to scan"; exit 0
          fi
          echo "$files" | sed 's/^/[scan] /'
          ! git grep -nE '^(<<<<<<<|=======|>>>>>>>)' -- $files
          ! git grep -nE '(^| )pbpaste( |$)|>> *README\.md' -- $files
          ! git grep -nE 'base64 -d|openssl .* -base64|gpg --decrypt' -- $files
